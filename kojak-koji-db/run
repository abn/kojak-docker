#!/bin/bash
set -e

POSTGRESQL_USER=${POSTGRESQL_USER:-"koji"}
POSTGRESQL_PASS=${POSTGRESQL_PASS:-"koji"}
POSTGRESQL_DB=${POSTGRESQL_DB:-"koji"}
POSTGRESQL_TEMPLATE=${POSTGRESQL_TEMPLATE:-"DEFAULT"}

POSTGRESQL_BIN=/usr/bin/postgres
POSTGRESQL_CONFIG_FILE=${PGDATA}/postgresql.conf

POSTGRESQL_SINGLE="$POSTGRESQL_BIN --single --config-file=$POSTGRESQL_CONFIG_FILE"

$POSTGRESQL_SINGLE <<< "CREATE USER $POSTGRESQL_USER WITH SUPERUSER;" > /dev/null
$POSTGRESQL_SINGLE <<< "ALTER USER $POSTGRESQL_USER WITH PASSWORD '$POSTGRESQL_PASS';" > /dev/null
$POSTGRESQL_SINGLE <<< "CREATE DATABASE $POSTGRESQL_DB OWNER $POSTGRESQL_USER TEMPLATE $POSTGRESQL_TEMPLATE;" > /dev/null

exec $POSTGRESQL_BIN --config-file=$POSTGRESQL_CONFIG_FILE

